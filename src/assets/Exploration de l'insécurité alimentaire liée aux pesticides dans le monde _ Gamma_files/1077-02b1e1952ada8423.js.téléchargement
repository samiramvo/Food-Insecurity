"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1077],{83995:function(e,t,r){r.d(t,{j:function(){return f}});var n=r(12741),o=r(96412),c=r(13089),a=r(95235);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var s={model:"gpt-3.5-turbo",provider:r(23313).nyn.Azure},f=function(){function e(t){var r=t.params;(0,o.Z)(this,e),(0,a.Z)(this,"params",void 0),this.params=i(i({},s),r)}return(0,c.Z)(e,[{key:"prepare",value:function(e){var t=e.variables,r=e.history,o=void 0===r?[]:r,c=e.params,a=this.getSystemChatMessage(t),u=this.getUserChatMessage(t);return{messages:[a].concat((0,n.Z)(o),[u]),params:i(i({},this.params),c)}}}]),e}()},58202:function(e,t,r){r.d(t,{T1:function(){return p},VG:function(){return d},Vh:function(){return h},rm:function(){return v}});var n=r(13089),o=r(96412),c=r(41701),a=r(90129),u=r(29017),i=r(48200),s=r(3907),f=r(95235);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=(0,i.Z)(e);if(t){var o=(0,i.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var p=function(e){(0,a.Z)(r,e);var t=l(r);function r(e,n){var a;return(0,o.Z)(this,r),a=t.call(this,e),(0,f.Z)((0,c.Z)(a),"name","StreamError"),(0,f.Z)((0,c.Z)(a),"code","stream_error"),n&&(a.code=n),a}return(0,n.Z)(r)}((0,s.Z)(Error)),v=function(e){(0,a.Z)(r,e);var t=l(r);function r(e){var n;return(0,o.Z)(this,r),n=t.call(this,e),(0,f.Z)((0,c.Z)(n),"name","StreamTimeoutError"),(0,f.Z)((0,c.Z)(n),"code","timeout"),n}return(0,n.Z)(r)}(p),d=function(e){(0,a.Z)(r,e);var t=l(r);function r(e){var n;return(0,o.Z)(this,r),n=t.call(this,e),(0,f.Z)((0,c.Z)(n),"name","StreamOnOpenError"),(0,f.Z)((0,c.Z)(n),"code","on_open"),n}return(0,n.Z)(r)}(p),h=function(e){(0,a.Z)(r,e);var t=l(r);function r(e){var n;return(0,o.Z)(this,r),n=t.call(this,e),(0,f.Z)((0,c.Z)(n),"name","StreamUnexpectedCloseError"),(0,f.Z)((0,c.Z)(n),"code","unexpected_close"),n}return(0,n.Z)(r)}(p)},47911:function(e,t,r){r.d(t,{M:function(){return g}});var n=r(95235),o=r(2784),c=r(27483),a=r(2702),u=r(6201),i=r(20406),s=r(96412),f=r(13089),l=r(41701),p=r(90129),v=r(29017),d=r(48200),h=r(28526),m=r.n(h),b=function(e){(0,p.Z)(o,e);var t,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(o);if(t){var n=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,v.Z)(this,e)});function o(e){var t,c;return(0,s.Z)(this,o),t=r.call(this,{start:function(){var t;null===(t=e.onStart)||void 0===t||t.call(e)},transform:(c=(0,i.Z)(m().mark(function r(n,o){var c,a,u;return m().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:"content"===n.event&&(t.content+=n.data,null===(c=e.onContent)||void 0===c||c.call(e,t.content)),"done"===n.event&&(null===(a=e.onComplete)||void 0===a||a.call(e,t.content)),"cancel"===n.event&&(null===(u=e.onCancel)||void 0===u||u.call(e)),o.enqueue(n);case 4:case"end":return r.stop()}},r)})),function(e,t){return c.apply(this,arguments)}),flush:function(){var t;null===(t=e.onFlush)||void 0===t||t.call(e)}}),(0,n.Z)((0,l.Z)(t),"content",""),t}return(0,f.Z)(o,[{key:"getContent",value:function(){return this.content}}]),o}(r(95993).GJ);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var g=function(e,t){return{generate:(0,o.useCallback)(function(r){var n=r.variables,o=r.interactionId,i=r.params,s=r.workspaceId;o=o||(0,u.nZ)();var f=e.prepare({variables:n,params:i,interactionId:o}),l=(0,c.z4)(O(O({},f),{},{workspaceId:s,interactionId:o}),{timeout:t.timeout}),p=l.cancel,v=l.stream,d=new b(t),h=v.pipeThrough(d);return{cancel:p,promise:new Promise(function(e,r){(0,a.GO)(h,{onError:function(e){var n;null===(n=t.onError)||void 0===n||n.call(t,e),r(e)},onDone:function(){e(d.getContent())}})})}},[t,e])}}},27483:function(e,t,r){r.d(t,{z4:function(){return x},pM:function(){return D}});var n,o,c=r(20406),a=r(95235),u=r(82269),i=r(13089),s=r(96412),f=r(90129),l=r(29017),p=r(48200),v=r(3907),d=r(28526),h=r.n(d),m=r(95993),b=r(37914),y=r(58202),O=function(e){(0,f.Z)(n,e);var t,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.Z)(n);if(t){var o=(0,p.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)});function n(){var e;return(0,s.Z)(this,n),r.call(this,{transform:(e=(0,c.Z)(h().mark(function e(t,r){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("error"!==t.event){e.next=3;break}return r.error(new y.T1("StreamError message received: ".concat(JSON.stringify(t)),t.data)),e.abrupt("return");case 3:if("cancel"!==t.event){e.next=6;break}return r.enqueue(t),e.abrupt("return");case 6:if("done"!==t.event){e.next=9;break}return r.enqueue(t),e.abrupt("return");case 9:if("content"!==t.event){e.next=12;break}return r.enqueue(t),e.abrupt("return");case 12:case"end":return e.stop()}},e)})),function(t,r){return e.apply(this,arguments)})})}return(0,i.Z)(n)}(m.GJ);function g(){return(g=(0,c.Z)(h().mark(function e(t,r){var n,o;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getReader();case 1:return e.next=3,n.read();case 3:if((o=e.sent).done){e.next=7;break}r(o.value),e.next=1;break;case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(){return{data:"",event:"",id:"",retry:void 0}}(n=o||(o={}))[n.NewLine=10]="NewLine",n[n.CarriageReturn=13]="CarriageReturn",n[n.Space=32]="Space",n[n.Colon=58]="Colon";var A=["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"];function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var E="text/event-stream",P="last-event-id";function j(e){var t=e.headers.get("content-type");if(!(null!=t&&t.startsWith(E)))throw Error("Expected content-type to be ".concat(E,", Actual: ").concat(t))}var k=["streamId","lastEventId","interactionId"],T=["headers"];function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var R=function(e){(0,f.Z)(n,e);var t,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.Z)(n);if(t){var o=(0,p.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)});function n(e){var t;return(0,s.Z)(this,n),(t=r.call(this)).timeout=e,t}return(0,i.Z)(n)}((0,v.Z)(Error)),x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=b.v.API_HOST+"/ai/chatCompletion",n={"Content-Type":"application/json"};return t.streamId&&(n["gamma-chat-completion-stream-id"]=t.streamId),H(r,{method:"POST",headers:n,body:JSON.stringify(e)},t)},D=function(e){var t=e.streamId,r=e.lastEventId,n=e.interactionId,o=(0,u.Z)(e,k),c=new URL(b.v.API_HOST+"/ai/resumeChatCompletion");return c.searchParams.set("interactionId",n),H(c.toString(),{method:"GET",headers:{"gamma-chat-completion-stream-id":t,"last-event-id":r}},_({streamResumingEnabled:!0},o))},H=function(e,t,r){var n,a=r.retries||0,i=r.backoff||1e3,s=r.timeout||null,f=null!==(n=r.streamResumingEnabled)&&void 0!==n&&n,l=0,p=new AbortController,v=!1,d=!1,b=!1,Z=null,k=!1,I=function(){return i*Math.pow(2,Math.max(l-1,0))},x={};return f&&(x["gamma-stream-resuming-enabled"]="true"),{stream:new m.Pz({start:function(r){return(0,c.Z)(h().mark(function n(){var i;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:null!=s&&(Z=setTimeout(function(){k=!0,p.abort(),r.error(new y.rm("Stream timed out after ".concat(s,"ms")))},s)),i=t.headers,(function(e,t){var r=t.signal,n=t.headers,a=t.onopen,i=t.onmessage,s=t.onclose,f=t.onerror,l=t.openWhenHidden,p=t.fetch,v=(0,u.Z)(t,A);return new Promise(function(t,u){var d,m=S({},n);function b(){d.abort(),document.hidden||T()}m.accept||(m.accept=E),l||document.addEventListener("visibilitychange",b);var y=1e3,O=0;function A(){document.removeEventListener("visibilitychange",b),window.clearTimeout(O),d.abort()}null==r||r.addEventListener("abort",function(){A(),t()});var Z=null!=p?p:window.fetch,k=null!=a?a:j;function T(){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)(h().mark(function r(){var n,c,a;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return d=new AbortController,r.prev=1,r.next=4,Z(e,S(S({},v),{},{headers:m,signal:d.signal}));case 4:return n=r.sent,r.next=7,k(n);case 7:return r.next=9,function(e,t){return g.apply(this,arguments)}(n.body,function(e){var t,r,n,c=!1;return function(a){void 0===t?(t=a,r=0,n=-1):t=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(t,a);for(var u=t.length,i=0;r<u;){c&&(t[r]===o.NewLine&&(i=++r),c=!1);for(var s=-1;r<u&&-1===s;++r)switch(t[r]){case o.Colon:-1===n&&(n=r-i);break;case o.CarriageReturn:c=!0;case o.NewLine:s=r}if(-1===s)break;e(t.subarray(i,s),n),i=r,n=-1}i===u?t=void 0:0!==i&&(t=t.subarray(i),r-=i)}}(function(e,t,r){var n=w(),c=new TextDecoder,a=!1;return function(u,i){if(0===u.length)null==r||r(n),n=w(),a=!1;else if(i>0){var s=c.decode(u.subarray(0,i)),f=i+(u[i+1]===o.Space?2:1),l=c.decode(u.subarray(f));switch(s){case"data":a?n.data=n.data+"\n"+l:(n.data=l,a=!0);break;case"event":n.event=l;break;case"id":e(n.id=l);break;case"retry":var p=parseInt(l,10);isNaN(p)||t(n.retry=p)}}}}(function(e){e?m[P]=e:delete m[P]},function(e){y=e},i)));case 9:null==s||s(),A(),t(),r.next=17;break;case 14:if(r.prev=14,r.t0=r.catch(1),!d.signal.aborted)try{a=null!==(c=null==f?void 0:f(r.t0))&&void 0!==c?c:y,window.clearTimeout(O),O=window.setTimeout(T,a)}catch(e){A(),u(e)}case 17:case"end":return r.stop()}},r,null,[[1,14]])}))).apply(this,arguments)}T()})})(e,_(_({openWhenHidden:!0,credentials:"include"},(0,u.Z)(t,T)),{},{headers:_(_({},i),x),signal:p.signal,onopen:function(){var e=(0,c.Z)(h().mark(function e(t){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.ok&&t.headers.get("content-type")===E)){e.next=4;break}return e.abrupt("return");case 4:if(!(t.status>=400&&t.status<500&&429!==t.status)){e.next=9;break}p.abort(),r.error(new y.VG("Unable to complete request")),e.next=15;break;case 9:if(!(l++<a&&!v)){e.next=13;break}throw new R(I());case 13:p.abort(),r.error(new y.VG("Unable to complete request"));case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),onmessage:function(e){if(b){d||(d=!0,console.log("[AIStream] enqueue cancel event",_(_({},e),{},{event:"cancel",data:""})),r.enqueue(_(_({},e),{},{event:"cancel",data:""})),r.close(),p.abort());return}k||(r.enqueue(e),v=!0)},onclose:function(){Z&&(clearTimeout(Z),Z=null),r.close()},onerror:function(e){if(e instanceof R){if(b)throw console.error("Stream cancelled - not retrying"),Error("Stream cancelled");return e.timeout}if(e instanceof Error){if(console.error("Uncaught stream error",e),!f)throw e;if(l++<a)return I();throw e}if(v){var t="Stream closed unexpectedly";throw console.error("Uncaught stream error",t),new y.Vh(t)}}})).catch(function(e){Z&&(clearTimeout(Z),Z=null),b||r.error(e)});case 3:case"end":return n.stop()}},n)}))()}}).pipeThrough(new O),cancel:function(){b||(b=!0)}}}},2702:function(e,t,r){r.d(t,{GO:function(){return i},fZ:function(){return f},uS:function(){return s}});var n=r(20406),o=r(28526),c=r.n(o),a=r(37164),u=r(58202),i=function(e,t){var r,o=e.getReader(),a=(r=(0,n.Z)(c().mark(function e(){var r,n,u,i,s,f;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.read();case 3:if(n=(r=e.sent).done,u=r.value,n){e.next=12;break}return null===(i=t.onMessage)||void 0===i||i.call(t,u),a(),e.abrupt("return");case 12:null===(s=t.onDone)||void 0===s||s.call(t);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),null===(f=t.onError)||void 0===f||f.call(t,e.t0 instanceof Error?e.t0:Error(e.t0));case 18:case"end":return e.stop()}},e,null,[[0,15]])})),function(){return r.apply(this,arguments)});a()},s=function(e){return e instanceof u.T1?{errorCode:e.code,errorMessage:e.message}:e instanceof Error?{errorMessage:e.message}:{errorMessage:e}},f=(0,a.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16)},6201:function(e,t,r){r.d(t,{Io:function(){return g},Lt:function(){return O},Wf:function(){return m},XH:function(){return y},fM:function(){return b},gb:function(){return f},hq:function(){return s},mV:function(){return l},nZ:function(){return w},o:function(){return v},pQ:function(){return h},qZ:function(){return p},vL:function(){return d}});var n=r(95235),o=r(37164),c=r(37914),a=r(32333);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var s=function(e){a.co.track(a.AA.AI_REQUEST_SENT,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},f=function(e){a.co.track(a.AA.AI_REQUEST_COMPLETE,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},l=function(e){a.co.track(a.AA.AI_REQUEST_ABORT,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},p=function(e){a.co.track(a.AA.AI_REQUEST_STREAM_START,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},v=function(e){a.co.track(a.AA.AI_REQUEST_RESPONSE,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},d=function(e){a.co.track(a.AA.AI_SUGGESTION_APPLY,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},h=function(e){a.co.track(a.AA.AI_REQUEST_ERROR,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},m=function(e){a.co.track(a.AA.AI_REQUEST_RETRY,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},b=function(e){a.co.track(a.AA.AI_DOC_RATED,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},y=function(e){a.co.track(a.AA.AI_DOC_FEEDBACK_SUBMITTED,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},O=function(e){a.co.track(a.AA.AI_IMAGE_FEEDBACK_SUBMITTED,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},g=function(e){a.co.track(a.AA.AI_IMAGE_RATED,i(i({},e),{},{gitSHA:c.v.GIT_SHA}))},w=function(){return(0,o.x0)()}},31975:function(e,t,r){r.d(t,{OI:function(){return o},uO:function(){return n}});var n=function(e,t){var r=0;return new Promise(function(n,o){!function c(){var a=setTimeout(function(){++r<t.maxRetries?c():o("timed out")},t.timeout);e().then(n).catch(o).finally(function(){clearTimeout(a)})}()})},o=function(e,t){return Promise.race([new Promise(function(e,r){setTimeout(function(){r(Error("timed out"))},t)}),e])}}}]);
//# sourceMappingURL=1077-02b1e1952ada8423.js.map