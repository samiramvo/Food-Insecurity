"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2310],{69862:function(t,r,e){e.d(r,{$D:function(){return h},An:function(){return v},Iy:function(){return d},ME:function(){return m},Og:function(){return p},eo:function(){return y}});var n=e(13089),o=e(96412),u=e(41701),i=e(90129),c=e(29017),a=e(48200),s=e(3907),f=e(95235);function l(t){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var e,n=(0,a.Z)(t);if(r){var o=(0,a.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,c.Z)(this,e)}}var p=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),n=r.call(this,t),(0,f.Z)((0,u.Z)(n),"opts",void 0),n.opts=i,n}return(0,n.Z)(e)}((0,s.Z)(Error));p.prototype.name="DesignPartnerError";var v=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),r.call(this,t,n)}return(0,n.Z)(e)}(p);v.prototype.name="CouldNotApplySuggestionError";var h=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),r.call(this,t,n)}return(0,n.Z)(e)}(p);h.prototype.name="InvalidResponseError";var m=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),r.call(this,t,n)}return(0,n.Z)(e)}(p);m.prototype.name="NoopSuggestionError";var d=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),r.call(this,"InputTooLongError: ".concat(t),n)}return(0,n.Z)(e)}(p);d.prototype.name="InputTooLongError";var y=function(t){(0,i.Z)(e,t);var r=l(e);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,e),r.call(this,"ParsedSuggestionError: ".concat(t),n)}return(0,n.Z)(e)}(p);m.prototype.name="ParsedSuggestionError"},28248:function(t,r,e){e.d(r,{_j:function(){return Z},oO:function(){return g},uc:function(){return d}});var n,o,u,i,c=e(95235),a=e(20406),s=e(28526),f=e.n(s),l=e(69862),p=e(23313),v=e(3915);function h(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),e.push.apply(e,n)}return e}function m(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?h(Object(e),!0).forEach(function(r){(0,c.Z)(t,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})}return t}var d=function(t){var r=(null==t?void 0:t.graphQLErrors)||[];return null==r?void 0:r.map(function(t){return t.code})},y=(n=(0,a.Z)(f().mark(function t(r){var e,n,o,u,i,c,a,s;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.fn,n=r.retries,u=void 0===(o=r.backoff)?1e3:o,i=r.timeout,t.prev=1,t.next=4,Promise.race([e(),new Promise(function(t,r){setTimeout(function(){return r(Error("Request timeout (".concat(i,"ms)")))},i)})]);case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),(a=null===(c=t.t0.message)||void 0===c?void 0:c.startsWith("Request timeout"))&&console.debug("[AI] Request timeout. Not retrying"),s=!d(t.t0).some(function(t){return["BAD_USER_INPUT"].includes(t)})&&!a,!(n>0&&s)){t.next=16;break}return t.next=15,new Promise(function(t){return setTimeout(t,u)});case 15:return t.abrupt("return",y({fn:e,retries:n-1,backoff:2*u,timeout:i}));case 16:throw t.t0;case 17:case"end":return t.stop()}},t,null,[[1,7]])})),function(t){return n.apply(this,arguments)}),g=(o=(0,a.Z)(f().mark(function t(r){var e,n;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=["gpt-3.5-turbo","gpt-3.5-turbo-16k"],t.next=3,b({input:r,models:e});case 3:if(n=t.sent){t.next=6;break}throw new l.Iy("Input too long for models: "+JSON.stringify(e));case 6:return t.abrupt("return",m(m({},r),{},{params:m(m({},r.params),{},{model:n})}));case 7:case"end":return t.stop()}},t)})),function(t){return o.apply(this,arguments)}),b=(u=(0,a.Z)(f().mark(function t(r){var e,n,o,u,i,c,a;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.input,u=r.models,t.next=3,(0,p.WQq)().query({query:p.yL,returnPartialData:!1,variables:{input:{messages:o.messages,maxTokens:null===(e=o.params)||void 0===e?void 0:e.maxTokens,models:u}}});case 3:if(!(!(c=null==(i=t.sent.data)?void 0:i.canRunChatCompletion)||0===c.length)){t.next=8;break}throw Error("No response received");case 8:if(a=null===(n=c.find(function(t){return!!t.canRun}))||void 0===n?void 0:n.model){t.next=11;break}return t.abrupt("return",null);case 11:return t.abrupt("return",a);case 12:case"end":return t.stop()}},t)})),function(t){return u.apply(this,arguments)}),Z=(i=(0,a.Z)(f().mark(function t(r){var e,n,o,u,i=arguments;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=i.length>1&&void 0!==i[1]?i[1]:{timeout:6e4,retries:0},console.debug("[AI][fetchChatCompletion]",r.messages,r.params),u=function(){return(0,p.WQq)().mutate({mutation:p.Dan,variables:{input:m(m({},r),{},{workspaceId:(0,v.n_)()})}}).then(function(t){var r=t.data,e=null==r?void 0:r.chatCompletion;if(!e||0===e.length)throw Error("No response received");return console.debug("[AI] Got chat completion",e),r})},t.abrupt("return",y({fn:u,timeout:null!==(e=o.timeout)&&void 0!==e?e:6e4,retries:null!==(n=o.retries)&&void 0!==n?n:0}));case 4:case"end":return t.stop()}},t)})),function(t){return i.apply(this,arguments)})},64426:function(t,r,e){e.d(r,{I:function(){return p}});var n,o=e(95235),u=e(20406),i=e(28526),c=e.n(i),a=e(68941),s=e(28248);function f(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),e.push.apply(e,n)}return e}function l(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?f(Object(e),!0).forEach(function(r){(0,o.Z)(t,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})}return t}var p=(n=(0,u.Z)(c().mark(function t(r,e){var n,o,u,i,f,p=arguments;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=p.length>2&&void 0!==p[2]?p[2]:{},i=a.VH.get("aiRequestRetries").chat,u.retries=null!==(n=u.retries)&&void 0!==n?n:i,t.next=5,(0,s._j)(l(l({},r),{},{interactionId:e}),u);case 5:return f=t.sent,t.abrupt("return",null==f?void 0:null===(o=f.chatCompletion)||void 0===o?void 0:o[0].content);case 7:case"end":return t.stop()}},t)})),function(t,r){return n.apply(this,arguments)})},87842:function(t,r,e){e.d(r,{u:function(){return l}});var n=e(96412),o=e(13089),u=e(41701),i=e(90129),c=e(29017),a=e(48200),s=e(95235),f=e(23313),l=function(t){(0,i.Z)(l,t);var r,e=(r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,e=(0,a.Z)(l);if(r){var n=(0,a.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,c.Z)(this,t)});function l(t){var r,o=t.variables,i=t.systemPrompt,c=t.userPrompt,a=t.params;return(0,n.Z)(this,l),r=e.call(this,{params:a}),(0,s.Z)((0,u.Z)(r),"variables",void 0),(0,s.Z)((0,u.Z)(r),"systemPrompt",void 0),(0,s.Z)((0,u.Z)(r),"userPrompt",void 0),r.variables=o,r.systemPrompt=i,r.userPrompt=c,r}return(0,o.Z)(l,[{key:"getSystemChatMessage",value:function(t){return{role:f.XaP.System,content:p(this.systemPrompt,t)}}},{key:"getUserChatMessage",value:function(t){return{role:f.XaP.User,content:p(this.userPrompt,t)}}}]),l}(e(83995).j);function p(t,r){var e=t;for(var n in r)e=e.replaceAll("{{".concat(n,"}}"),r[n]);return e}}}]);
//# sourceMappingURL=2310-daf4afcf8278ec05.js.map